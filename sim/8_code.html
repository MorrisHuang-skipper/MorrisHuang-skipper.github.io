<!-- HTML generated using hilite.me --><div style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;"><pre style="margin: 0; line-height: 125%"><span style="color: #008000"># 2020/1/12 Morris</span>

    <span style="color: #008000"># import package</span>
    <span style="color: #0000ff">from</span> vpython <span style="color: #0000ff">import</span> *
    
    <span style="color: #008000"># parameter setting</span>
    k = 9E9                 <span style="color: #008000"># Coulomb constant</span>
    ec = 1.6E-19            <span style="color: #008000"># electron charge</span>
    radius = 1.2E-14        <span style="color: #008000"># radius of charge</span>
    field = []              <span style="color: #008000"># store electric field arrow</span>
    arrow_length = 3E-14    <span style="color: #008000"># length of arrow</span>
    dt = 0.01               <span style="color: #008000"># update time interval</span>
    m = 1.6E-27             <span style="color: #008000"># mass of charge</span>
    
    <span style="color: #0000ff">def</span> main():
        <span style="color: #a31515">&#39;&#39;&#39;main function&#39;&#39;&#39;</span>
        <span style="color: #008000"># create scene</span>
        scene = canvas(width=1000, height=600, align=<span style="color: #a31515">&#39;left&#39;</span>, range=3E-13)
    
        <span style="color: #008000"># create two plates and create a capacitor </span>
        up_plate = box(pos=vec(0, 1E-13, 0), size=vec(4E-13, 4E-16, 4E-13),
                       color=color.blue)
        down_plate = box(pos=vec(0, -1E-13, 0), size=vec(4E-13, 4E-16, 4E-13),
                         color=color.red)
    
        <span style="color: #008000"># fill the plates with charge</span>
        <span style="color: #0000ff">for</span> x <span style="color: #0000ff">in</span> range(-20, 22, 2):
            <span style="color: #0000ff">for</span> y <span style="color: #0000ff">in</span> [up_plate.pos.y, down_plate.pos.y]:
                <span style="color: #0000ff">for</span> z <span style="color: #0000ff">in</span> range(-20, 22, 2):
                    <span style="color: #008000"># positive charge and negative charge locate at top plate and down plate</span>
                    <span style="color: #0000ff">if</span> y &gt; 0: mu = 1
                    <span style="color: #0000ff">else</span>: mu = -1
                    Create_Charge(vec(x*1E-14, y, z*1E-14), mu)
    
        <span style="color: #008000"># create field between plates</span>
        <span style="color: #0000ff">for</span> x <span style="color: #0000ff">in</span> range(-9, 9, 4):
            <span style="color: #0000ff">for</span> y <span style="color: #0000ff">in</span> range(-9, 9, 4):
                <span style="color: #0000ff">for</span> z <span style="color: #0000ff">in</span> range(-9, 9, 4):
                    Create_Field(vec(x*2E-14, y*1E-14, z*2E-14))
    
        <span style="color: #008000"># create a moving charge</span>
        moving_charge = sphere(pos=vec(-4E-13, 5E-14, 0), radius=radius,
                               coulomb=5E-42*ec, color=color.green,
                               v=vec(1.5E-13, 0, 0), make_trail=True)
    
        <span style="color: #008000"># simulation</span>
        <span style="color: #0000ff">while</span> True:
            rate(1/dt)
            <span style="color: #008000"># update the velcocity and position of moving charge</span>
            Update(moving_charge)
    
    charges = []
    <span style="color: #0000ff">def</span> Create_Charge(pos, C):
        <span style="color: #a31515">&#39;&#39;&#39;input coulomb and position of the charge and create it&#39;&#39;&#39;</span>
        charge = sphere(pos=pos, radius=radius, coulomb=C*ec)
        <span style="color: #008000"># red and blue represent negative and positive charge respectively</span>
        <span style="color: #0000ff">if</span> C &gt; 0: charge.color = color.blue
        <span style="color: #0000ff">else</span>: charge.color = color.red
        <span style="color: #008000"># store all charge inside charges[]</span>
        charges.append(charge)
    
    <span style="color: #0000ff">def</span> Create_Field(pos):
        <span style="color: #a31515">&#39;&#39;&#39;for a given position calculate electric field&#39;&#39;&#39;</span>
        <span style="color: #008000"># intialize the electric field</span>
        E = vec(0, 0, 0)
        <span style="color: #008000"># use superposition quality of electric field to calcuate the field</span>
        <span style="color: #0000ff">for</span> charge <span style="color: #0000ff">in</span> charges:
            E += k*charge.coulomb*(pos-charge.pos)/mag(pos-charge.pos)**3
        <span style="color: #008000"># use color to show the magnitude of electric field</span>
        color = Mapping(mag(E))
        field.append(arrow(pos=pos, axis=hat(E)*arrow_length,
                           color=vec(1, color, 0)))
    
    <span style="color: #008000"># mapping from (Inf, 0) to (1, 0), and convert into rgb color</span>
    <span style="color: #0000ff">def</span> Mapping(E):
        <span style="color: #a31515">&#39;&#39;&#39;mapping from (Inf, 0) to (1, 0) as the rgb color value&#39;&#39;&#39;</span>
        a = 1E-17
        <span style="color: #0000ff">return</span> 1-exp(-a*E)
    
    <span style="color: #008000"># calculate charge motion</span>
    <span style="color: #0000ff">def</span> Update(obj):
        <span style="color: #a31515">&#39;&#39;&#39;given a charge and position and update position&#39;&#39;&#39;</span>
        <span style="color: #008000"># first calculate electric field at a given position</span>
        E = vec(0, 0, 0)
        <span style="color: #008000"># superposition quality</span>
        <span style="color: #0000ff">for</span> charge <span style="color: #0000ff">in</span> charges:
            E += k*charge.coulomb*(obj.pos-charge.pos)/mag(obj.pos-charge.pos)**3
        <span style="color: #008000"># use formula: s = v0*t + 1/2*a*t^2</span>
        obj.v += obj.coulomb*E/m*dt
        obj.pos += obj.v*dt
    
    main()
    </pre></div>
    